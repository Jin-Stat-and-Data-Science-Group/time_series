---
title: "第一章"
author: "Zeng"
date: '2019-12-10'
output: pdf_document
css: ./style/markdown.css
bibliography: Bibfile.bib
eqnPrefixTemplate: ($$i$$)
link-citations: true
linkReferences: true
notice: '@*'
csl: ./style/chinese-gb7714-2005-numeric.csl
autoEqnLabels: true
---


```{r setup, echo=F}

################# 第 1 章 R 程序代码  ####################


knitr::opts_knit$set(root.dir = getwd())
knitr::opts_chunk$set(echo = FALSE, results = 'hide')
knitr::opts_chunk$set(warning = FALSE, message=FALSE)
```

```{r prepare}
rm(list=ls())
options(digits=4)
options(scipen=100)
graphics.off()
Sys.setlocale("LC_ALL", "Chinese")
```



# 金融数据及其特征
## 资产收益率
设${P_t}$是$t$时刻的资产价格，下面给出本书中用到的一些资产收益率的定义。暂时假定该过程资产不支付红利。

### 单期简单收益率
假设投资者在一个周期内拥有某种资产，从$t-1$天到第$t$天，其**简单毛收益**为：\[1 + {R_t} = \frac{{{P_t}}}{{{P_{t - 1}}}}or{P_t} = {P_{t - 1}}(1 + {R_t})\]
相对应的**单期简单净收益率**或**简单收益率**为：\[{R_t} = \frac{{{P_t}}}{{{P_{t - 1}}}} - 1 = \frac{{{P_t} - {P_{t - 1}}}}{{{P_{t - 1}}}}\]

### 多期简单收益率
假设从第$t-k$天到第$t$天，这$k$个周期内持有某种资产，则**k期简单毛收益率**为：$$\begin{array}{l}
1 + R[k] = \frac{{{P_t}}}{{{P_{t - k}}}} = \frac{{{P_t}}}{{{P_{t - 1}}}} \cdot \frac{{{P_{t - 1}}}}{{{P_{t - 2}}}} \cdot  \cdot  \cdot  \cdot \frac{{{P_{t - k + 1}}}}{{{P_{t - k}}}}\\
 = (1 + {R_t})(1 + {R_{t - 1}}) \cdot  \cdot  \cdot (1 + {P_{t - k + 1}})\\
 = \coprod\limits_{j = 0}^{k - 1} {(1 + {R_{t - j}})} 
\end{array}$$这样，$k$期简单毛收益率是其包含的这$k$个简单毛收益率的乘积，c称为**复合收益率**。$k$期简单净收益率为\[{R_t}[k] = ({P_t} - {P_{t - k}})/{P_{t - k}}\]

### 连续复合收益率
资产的简单毛收益率的自然对数称为**连续复合收益率**或**对数收益率**：\[{r_t} = \ln (1 + {R_t}) = \ln \frac{{{P_t}}}{{{P_{t - 1}}}} = {p_t} - {p_{t - 1}}\]其中，${p_t} = \ln {P_t}$，与简单净收益率$R_t$相比，连续复合收益率$r_t$有很多优点。首先，对多期收益率，我们有\[\begin{array}{l}
{r_t} = [k] = \ln (1 + {R_t}[k]) = \ln [(1 + {R_t})(1 + {R_{t - 1}}) \cdot  \cdot  \cdot (1 + {R_{t - k + 1}})]\\
 = \ln (1 + {R_t}) + \ln (1 + {R_{t - 1}}) +  \cdot  \cdot  \cdot  + \ln (1 + {R_{t - k + 1}})\\
 = {r_t} + {r_{t - 1}} +  \cdot  \cdot  \cdot  + {r_{t - k + 1}}
\end{array}\]这样，连续复合多期收益率是它所包含的连续复合单期收益率之和。其次，对数收益率具有更容易处理的统计特性。

### 资产组合收益率
若一个资产组合由$N$项资产组成，则该资产组合的简单净收益率是它所包含的各项资产的简单净收益率的加权平均，其中每个资产的权重是该资产的价值占资产组合总价值的百分比。设$p$是一个资产组合，它在第$i$项资产上的权重为${\omega _i}$，那么$p$在$t$时刻的简单收益率为${R_{p,t}} = \sum\limits_{i = 1}^N {{\omega _i}{R_{it}}}$,其中${R_{it}}$是组合中第$i$个资产的简单收益率。

### 红利支付
如果一项资产周期性地支付红利，则我们需要修改资产收益率的定义。设$D_t$是一项资产在第$t-1$天和低$t$天之间支付的红利，$P_t$是该资产在第$t$个周期末的价格。这样，红利并没有包含在$P_t$中。则$t$时刻的简单净收益率和连续复合收益率分别为\[{R_t} = \frac{{{P_t} + {D_t}}}{{{P_{t - 1}}}} - 1,{r_t} = \ln ({P_t} + {D_t}) - \ln ({P_{t - 1}})\]

### 超额收益率
一项资产在$t$时刻的超额收益率是该项资产的收益率与某项参照资 产的收益率之差。参照资产通常是无风险的，如美国短期国债收率 。简单超额收益率和对数超额收益率分别定义为\[{Z_t} = {R_t} - {R_{0t}},{z_t} = {r_t} - {r_{0t}}\]其中，$R_{0t}$和$r_{ot}$分别是该参照资产的简单收益率和对数收益率。在金融学文献中，超额收益率被认为是一个套利投资组合的盈利。在这个资产组合中，对某资产持有多头头寸而对其参照资产持有空头头寸，且初始净投资额为零。

**注记**：多头金融头寸是在持有某资产。空头头寸是指卖出不属于自己的资产，这需要通过从已购买该资产的投资者那里借入资产来实现。随后的某天，卖空者有义务买进与借入时完全相同数量的份额来偿还借出者。偿还时要求相等数量的份额，而不是相等数量的美元，因此卖空者会由于该资产价格的下跌而获利。如果空头持有期间该资产支付现金红利，这些红利将支付给做空合约的买方。卖空者必须从自己的资源里支付相应的现金红利来补偿借出者。换句话说，空头方由义务支付所借资产的现金红利给资产的借出方。

### 关系小结
简单收益率$R_t$与连续复合对数收益率$r_t$的关系是$${r_t} = \ln (1 + {R_t}),R_t=e^{r_t}-1$$如果收益率$R_t$与$r_t$用百分数表示，则有$${r_t} = 100\ln (1 + \frac{{{R_t}}}{{100}}),R_t=100(e^{r_t/100}-1)$$把收益率进行时间累加，则有\[\begin{array}{l}
1 + {R_t}[k] = (1 + {R_t})(1 + {R_{t - 1}}) \cdot  \cdot  \cdot (1 + {R_{t - k + 1}})\\
{r_t}[k] = {r_t} + {r_{t - 1}} +  \cdot  \cdot  \cdot  + {r_{t - k + 1}}
\end{array}\]如果连续复合年利率为$r$，则资产现值与未来价值之间的关系为\[A = C\exp (r \cdot n),C = Aexp( - r \cdot n)\]

## 债券收益和价格
债券是一种金融工具，在到期日，向债券的持有者支付票面价值（或面值）。有些债券根据**票面利率**定期支付利息。而零息债券则不需要定期支付利息。

### 当期收益率
当期收益率是指每年支付给投资者回报的百分数。从数学上，我们有$$\text{当期收益率}=\frac{{{\text{支付的年度利息额}}}}{{\text{债券的市场价格}}}\times 100\%$$ 这里，我们用下标$t$表示收益率通常随时间变化。从定义可知，当期收益率不包含任何投资过程中的资本收益或损失。对于零息债券，收益率的计算方法如下：$$\text{当期收益率}={(\frac{{\text{面值}}}{{\text{购买价格}}})^{1/k}}-1$$这里，$k$指用年度表示的到期时间。

### 到期收益率
当期收益率没有考虑货币的时间价值，因为它没有考虑投资者未来收到的债券利息的当前价值。因此，一个较为常用的债券投资收益是到期收益率(YTM)。到期收益率是通过将债券的价格与将来所有的现金流入的现值相等而计算出的收益率。在购买日和到期日之间，假设该债券的投资者收到$K$期利息支付。$y$为债券的到期收益率，$P$为债券的价格，则有\[P = \frac{{{C_1}}}{{1 + y}} + \frac{{{C_2}}}{{{{(1 + y)}^2}}} +  \cdot  \cdot  \cdot  + \frac{{{C_k} + F}}{{{{(1 + y)}^k}}}\]这里，$F$为债券的面值，$C_i$是第$i$期的利息支付。假定每年的债券票面利率为$\alpha$，每年支付的次数为$m$，到期时间为$n$年，则债券利息每期的现金流入为$F\alpha /m$，支付期数为$k=mn$，债券价格和到期收益率计算如下\[\begin{array}{l}
P = \frac{{\alpha F}}{m}[\frac{1}{{1 + y}} + \frac{1}{{{{(1 + y)}^2}}} +  \cdot  \cdot  \cdot  + \frac{1}{{{{(1 + y)}^k}}}] + \frac{F}{{{{(1 + y)}^k}}}\\
 = \frac{{\alpha F}}{{my}}[1 - \frac{1}{{{{(1 + y)}^k}}}] + \frac{F}{{{{(1 + y)}^k}}}
\end{array}\]

## 隐含波动率
股票期权是一种金融合约。股票A的看涨期权是这样一种合约，即合约持有者在给定的期间内以约定的价格购买一定数量股票A的权利，而不是义务。股票A的跌期权是这样一种合约，即合约持有者在给定的期间内以约定的价格卖出一定数量股票A的权利，而不是义务。这里约定的价格称为**执行价格**，给定的时间期间称为**到期日**。如果期权在立即执行时给其持有人的现金流为正，我们称这种期权为**价内期权**。如果期权在执行时,给其持有人的现金流为负，我们称其为**价外期权**。最后，如果期权在执行时给持有人的现金流为零，我们称它为**平价期权**。

股票期权价格的影响因素有很多，比如执行价格、无风险利率、当前股价以及股票的波动率。例如，著名的Black-Scholes模型，该模型在股票价格服从几何布朗运动的前提下，推导出其解析解。本章中，只要注意到Black-Scholes模型中唯一的一个不能直接观测到的因子是股票的波动率就可以了。这里的波动率指股票价格的条件标准差。在实践中，我们可以用观测到的股票价格和Black-Scholes模型来反向推导出其波动率，这个波动率称为**隐含波动率**，类似于债券到期收益率的实现过程，隐含波动率可以近似得到。

## 收益率的分布性质
**统计分布及其矩的回顾**

简要的回顾一下统计分布的基本性质和随机变量的矩。$R^k$表示$k$维欧几里得空间，$x \in {R^k}$b表示$x$是$R^k$中的一个点。考虑两个随机变量$X = {({X_1}, \cdot  \cdot  \cdot ,{X_k})^T}$和$Y = {({Y_1}, \cdot  \cdot  \cdot ,{Y_k})^T}$，令$P(X \in A,Y \in B)$表示$X$在子空间$A \subset {R^k}$且$Y$在子空间$B \subset {R^q}$中的概率。大多数时候，这里都假定随机变量是连续的。

### 联合分布
函数${F_{X,Y}}(x,y;\theta ) = P(X \le x,Y \le y;\theta )$表示变量X与Y的参数$\theta$的联合分布函数，其中$x \in {R^p},y \in {R^q}$,X和Y的规律可由联合分布函数${F_{X,Y}}(x,y;\theta )$来刻画。例如，X和Y之间的线性相依性可以由联合分布的协方差来给出。如果X和Y的联合概率密度函数${f_{X,Y}}(x,y;\theta )$存在，则\[{F_{X,Y}}(x,y;\theta ) = \int_{ - \infty }^x {\int_{ - \infty }^y {{f_{X,Y}}(w,z;\theta )} } dzdw\]这里，X和Y是连续随机向量。

### 边际分布
X的边际分布为\[{F_X}(x;\theta ) = {F_{X,Y}}(x,\infty , \cdot  \cdot  \cdot ,\infty ;\theta )\]这样，X的边际分布可通过对Y求积分得到，Y的边际分布也可以类似得到。

如果k=1，X是一个标量随机变量，其分布函数变成\[{F_X}(x) = P(X \le x;\theta )\]称为X的**累积分布函数(CDF)**，简称为分布函数。

### 条件分布
给定$Y \le y$的条件下，X的条件分布为\[{F_{X|Y \le y}}(x;\theta ) = \frac{{P(X \le x,Y \le y;\theta )}}{{P(Y \le y;\theta )}}\]若概率密度函数存在，则在给定Y=y的条件下，X的条件密度为\[{f_{x|y}}(x;\theta ) = \frac{{{f_{x,y}}(x,y;\theta )}}{{{f_y}(y;\theta )}}\]其中，边际密度${{f_y}(y;\theta )}$可由下式得到\[{f_y}(y;\theta ) = \int_{ - \infty }^\infty  {{f_{x,y}}(x,y;\theta )dx} \]从而，联合分布、边际分布和条件分布的关系可表示为\[{f_{x,y}}(x,y;\theta ) = {f_{x|y}}(x;\theta )\times{f_y}(y;\theta )\]这个等式关系在时间序列分析中经常用到（如在极大似然估计时）。最后，X与Y是相互独立的随机向量，当且仅当${f_{x,y}}(x,y;\theta ) = {f_x}(x;\theta )$时${f_{x,y}}(x,y;\theta ) = {f_x}(x;\theta )\times{f_y}(y;\theta )$。

### 随机变量的矩
一个连续随机变量X的l阶矩定义为\[{m_t}^\prime  = E(X^l) = \int_{ - \infty }^\infty  {{x^l}} f(x)dx\]其中E表示期望，$f(x)$是X的概率密度函数。一阶矩称为X的均值或期望，它用来度量该分布的中心位置，记为$\mu_t$，对于资产，感兴趣的是它的均值是否为零。

第l阶中心距定义为\[{m_t}  = E[{(X - {\mu _x})^l}] = \int_{ - \infty }^\infty  {(x - } {\mu _x}{)^l}f(x)dx\]这里假定上式中积分存在。二阶中心矩可以度量X偏离其均值的程度，称为X的方差，几位${\sigma _x}^2$。方差的正平方根${\sigma _x}$，称为X的标准差。对于资产收益率，方差是测量不确定性的指标。因此经常用于资产的风险管理和度量。随机变量的正态分布可由它的钱两阶矩来确定。而对于其他分布，可能需要更高阶的矩。

X的三阶中心矩度量其均值的对称性，而四阶中心矩度量X的尾部特征。在统计学中，标准化的三阶中心矩称为偏度，标准化的四阶中心矩称为峰度，它们分别用来描述随机变量的非对称程度和其尾部厚度。具体来说，X的偏度和峰度分别定义为\[S(x) = E[\frac{{{{(X - {\mu _x})}^3}}}{{{\sigma _x}^3}}],K(x) = E[\frac{{{{(X - {\mu _x})}^4}}}{{{\sigma _x}^4}}]\]

设$\{ {x_1}, \cdot  \cdot  \cdot ,{x_T}\}$是X的T个观测值，其样本均值表示为\[{{\hat \mu }_x} = \frac{1}{T}\sum\limits_{t = 1}^T {{x_t}} \]
样本方差表示为\[{\sigma _x}^2 = \frac{1}{{T - 1}}\sum\limits_{t = 1}^T {{{({x_t} - {{\hat \mu }_x})}^2}} \]
样本偏度表示为\[\hat S(x) = \frac{1}{{(T - 1){\sigma _x}^3}}\sum\limits_{t = 1}^T {{{({x_t} - {{\hat \mu }_x})}^3}} \]
样本峰度为\[\hat K(x) = \frac{1}{{(T - 1){\sigma _x}^4}}\sum\limits_{t = 1}^T {{{({x_t} - {{\hat \mu }_x})}^4}} \]如果X是一个正态随机变量，则$\hat S(x)$和$\hat K(x)-3$的分布渐进为均值为零、方差分别是6/T和24/T的正态分布，我们可以用这些渐进分布的性质来检验资产收益率是否具有正态性。给定一个资产收益率序列$\{ {r_1}, \cdot  \cdot  \cdot ,{r_T}\}$，要检验其偏度，考虑原假设${H_0}:S(r) =0$和备注假设${H_a}:S(r) \ne 0$，则检验统计量为\[t = \frac{{\hat S(r)}}{{\sqrt {6/T}}}\]决策规则如下：在显著性水平为$\alpha$时，若满足$|t| > {Z_{1 - \alpha /2}}$，则拒绝原假设。

类似地，我们可以检验收益率序列的超额峰度，假设${H_0}:K(r) - 3 = 0$，其备注假设为${H_a}:K(r) - 3 \ne 0$。则检验统计量为\[t = \frac{{\hat K(r) - 3}}{{\sqrt {24/T} }}\]该统计量服从一个渐进的标准正态分布。当且仅当检验统计量p值小于显著性水平$\alpha$时，决策规则拒绝原假设$H_0$。Jarque和Bera(1987)将两个先验检验结合在一起检验$r_t$的正态性，则检验统计量为\[JB = \frac{{\hat S(r)}}{{\sqrt {6/T} }} + \frac{{{{(\hat K(r) - 3)}^2}}}{{24/T}}\]该统计量渐进为一个自由度为2的${\chi ^2}$随机变量。当JB统计量的p值小于显著性水平$\alpha$时，则拒绝正态性分布的原假设。

## 一些统计分布
### 正态分布
在金融研究中，传统的假设是：简单收益率是独立同分布的，且都服从一个固定均值和方差的正态分布

### 对数正态分布
另一个常用的假设是：资产的对数收益率$r_t$是独立同分布，且服从一个均值为μ、方差为$\sigma^2$的正态分布。简单收益率是独立同分布的对数正态随机变量，其均值和方差分别为：
$$
E\left(R_{t}\right)=\exp \left(\mu+\frac{\sigma^{2}}{2}\right)-1, \quad \operatorname{Var}\left(R_{t}\right)=\exp \left(2 \mu+\sigma^{2}\right)\left[\exp \left(\sigma^{2}\right)-1\right]
$$
假设简单收益率$R_t$服从对数正态分布，其均值为$m_1$,方差为$m_2$，则对应的对数收益率$r_t$的均值和方差分别为：
$$
E\left(r_{t}\right)=\ln \left[\frac{m_{1}+1}{\sqrt{1+\frac{m_{2}}{\left(1+m_{1}\right)^{2}}}}\right],\quad \operatorname{Var}\left(r_{r}\right)=\ln \left(1+\frac{m_{2}}{\left(1+m_{1}\right)^{2}}\right)
$$
因为有限个独立同分布的正态随机变量之和仍服从正态分布，所以在$\{ {r_t}\}$是正态分布的假设下,${r_t}[k]$也服从正态分布。

### 稳态分布
稳态分布是正态分布的自然推广，在加法运算下是稳定的，这一点满足连续复合收益率$r_t$的要求。而且稳态分布能刻画股票的历史收益率所显示出来的超额峰度

### 正态分布的尺度混合
在最近股票收益率研究中，人们倾向于利用正态分布的尺度混合或有限混合。在正态分布的尺度混合假定下，对数收益率$r_t$服从均值为μ、方差为$\sigma^2$的正态分布。$\sigma^2$是一个随机变量，正态分布的一个有限混合的例子为
$$
r_{t} \sim(1-X) N\left(\mu_{t}, \sigma_{1}\right)+X N\left(\mu, \sigma_{t}^{2}\right)
$$
其中，X是一个服从Bernoulli分布的随机变量，$\sigma_{1}^{2}$较小，$\sigma_{2}^{2}$相对较大。混合正态分布的优点是他们保持了正态分布的易处理性、具有有限高阶矩且能刻画出这些超额峰度。

### 多元收益率
设$r_{t}=\left(r_{1t}, \ldots, r_{Nt}\right)^{\prime}$是N个资产在t时刻的对数收益率多元分布关心\[\{ {r_t}\} _{t = 1}^T\]的联合分布。在投资组合和风险管理中，人们最关心的是$r_t$的条件期望和条件协方差矩阵随时间怎样变化。  
假设X的期望存在，当$X \in\left\{x_{1}, \cdots, x_{T}\right\}$时，样本均值和样本协方差矩阵定义为$$
\hat{\mu}_{x}=\frac{1}{T} \sum_{j=1}^{T} x_{i}, \quad \hat{\Sigma}_{x}=\frac{1}{T-1} \sum_{j=1}^{T}\left(x_{i}-\hat{\mu}_{x}\right)\left(x_{i}-\hat{\mu}_{x}\right)^{\prime}
$$
假设X的协方差矩阵存在，那么这些样本统计量都是他们理论上的一致估计。在金融文献中，多元正态分布常用对数收益率$r_t$来表示。
```
#检查二元正态假设的有效性，可以使用统计模拟的方法。
library(mnormt)
rmnorm(n,mean,varcov)
-n：样本数据个数
-mean：均值
-varcov：协方差矩阵
```

























